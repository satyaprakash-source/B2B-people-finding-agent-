<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AuroEdge ‚Äî People Research</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=Instrument+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f2ee;
    --white: #ffffff;
    --black: #0e0c0a;
    --brand: #e85c2a;
    --brand-dark: #c44a1e;
    --brand-light: #fdf0eb;
    --border: #e0dbd4;
    --muted: #8c8278;
    --text: #1a1714;
    --success: #1a7a4a;
    --success-bg: #e8f7ef;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Instrument Sans', sans-serif;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* ‚îÄ‚îÄ NOISE TEXTURE OVERLAY ‚îÄ‚îÄ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.035'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.6;
  }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  header {
    position: relative;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 40px;
    background: var(--white);
    border-bottom: 1px solid var(--border);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-mark {
    width: 36px;
    height: 36px;
    background: var(--brand);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .logo-mark svg { width: 20px; height: 20px; fill: white; }

  .logo-name {
    font-family: 'Syne', sans-serif;
    font-size: 20px;
    font-weight: 800;
    color: var(--black);
    letter-spacing: -0.3px;
  }

  .logo-name span { color: var(--brand); }

  .header-tag {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 100px;
    padding: 5px 14px;
  }

  /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
  main {
    position: relative;
    z-index: 1;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 60px 24px;
  }

  .card {
    background: var(--white);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 520px;
    overflow: hidden;
    box-shadow: 0 4px 40px rgba(14,12,10,0.06), 0 1px 4px rgba(14,12,10,0.04);
  }

  /* ‚îÄ‚îÄ CARD TOP ‚îÄ‚îÄ */
  .card-top {
    background: var(--black);
    padding: 36px 40px 32px;
    position: relative;
    overflow: hidden;
  }

  .card-top::before {
    content: '';
    position: absolute;
    top: -60px; right: -60px;
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(232,92,42,0.25) 0%, transparent 70%);
    pointer-events: none;
  }

  .card-top::after {
    content: '';
    position: absolute;
    bottom: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(232,92,42,0.4), transparent);
  }

  .card-eyebrow {
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--brand);
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .card-eyebrow::before {
    content: '';
    display: inline-block;
    width: 18px;
    height: 2px;
    background: var(--brand);
  }

  .card-title {
    font-family: 'Syne', sans-serif;
    font-size: 30px;
    font-weight: 800;
    color: white;
    line-height: 1.1;
    letter-spacing: -0.5px;
  }

  .card-title span { color: var(--brand); }

  .card-desc {
    margin-top: 10px;
    font-size: 13px;
    color: rgba(255,255,255,0.4);
    line-height: 1.6;
    font-weight: 300;
  }

  /* ‚îÄ‚îÄ CARD BODY ‚îÄ‚îÄ */
  .card-body { padding: 36px 40px 40px; }

  .form-group {
    margin-bottom: 20px;
  }

  label {
    display: block;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  .input-wrap {
    position: relative;
  }

  .input-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    pointer-events: none;
    font-size: 15px;
  }

  input[type="text"] {
    width: 100%;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 13px 14px 13px 42px;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 14px;
    color: var(--text);
    outline: none;
    transition: all 0.2s;
    font-weight: 400;
  }

  input[type="text"]:focus {
    border-color: var(--brand);
    background: white;
    box-shadow: 0 0 0 3px rgba(232,92,42,0.1);
  }

  input::placeholder { color: var(--muted); opacity: 0.6; }

  /* ‚îÄ‚îÄ SUGGESTIONS ‚îÄ‚îÄ */
  .suggestions {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-top: 8px;
  }

  .chip {
    background: var(--brand-light);
    border: 1px solid rgba(232,92,42,0.2);
    border-radius: 6px;
    padding: 3px 10px;
    font-size: 11px;
    color: var(--brand-dark);
    cursor: pointer;
    transition: all 0.15s;
    font-weight: 500;
  }

  .chip:hover {
    background: var(--brand);
    color: white;
    border-color: var(--brand);
  }

  /* ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ */
  .divider {
    height: 1px;
    background: var(--border);
    margin: 24px 0;
  }

  /* ‚îÄ‚îÄ WEBHOOK CONFIG ‚îÄ‚îÄ */
  .webhook-row {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .webhook-input {
    flex: 1;
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 10px 14px;
    font-family: 'Instrument Sans', sans-serif;
    font-size: 12px;
    color: var(--text);
    outline: none;
    transition: all 0.2s;
  }

  .webhook-input:focus { border-color: var(--brand); }
  .webhook-input::placeholder { color: var(--muted); opacity: 0.5; font-size: 11px; }

  .btn-save {
    background: var(--bg);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 10px 16px;
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.15s;
    white-space: nowrap;
    font-family: 'Instrument Sans', sans-serif;
  }

  .btn-save:hover {
    border-color: var(--brand);
    color: var(--brand);
    background: var(--brand-light);
  }

  .webhook-label {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 1.2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
  }

  /* ‚îÄ‚îÄ SUBMIT BUTTON ‚îÄ‚îÄ */
  .btn-submit {
    width: 100%;
    background: var(--brand);
    border: none;
    border-radius: 12px;
    padding: 16px;
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 0.5px;
    color: white;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    overflow: hidden;
    margin-top: 4px;
  }

  .btn-submit::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255,255,255,0.12), transparent);
    pointer-events: none;
  }

  .btn-submit:hover {
    background: var(--brand-dark);
    transform: translateY(-1px);
    box-shadow: 0 8px 24px rgba(232,92,42,0.3);
  }

  .btn-submit:active { transform: translateY(0); }

  .btn-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .btn-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  /* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
  .spinner {
    display: none;
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* ‚îÄ‚îÄ STATUS BANNER ‚îÄ‚îÄ */
  .status {
    display: none;
    border-radius: 10px;
    padding: 14px 18px;
    font-size: 13px;
    line-height: 1.5;
    margin-top: 16px;
    font-weight: 400;
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .status.success {
    background: var(--success-bg);
    border: 1px solid rgba(26,122,74,0.2);
    color: var(--success);
  }

  .status.error {
    background: #fef2f0;
    border: 1px solid rgba(232,92,42,0.25);
    color: #c44a1e;
  }

  .status.loading {
    background: #f0f4ff;
    border: 1px solid rgba(60,100,220,0.15);
    color: #3a6bc7;
  }

  .status-icon { font-size: 16px; margin-right: 6px; }

  .sheet-link-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    background: var(--success);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    text-decoration: none;
    font-family: 'Instrument Sans', sans-serif;
    transition: all 0.15s;
  }

  .sheet-link-btn:hover { background: #145f39; }

  /* ‚îÄ‚îÄ PROGRESS STEPS ‚îÄ‚îÄ */
  .progress-steps {
    display: none;
    flex-direction: column;
    gap: 8px;
    margin-top: 16px;
    padding: 16px;
    background: var(--bg);
    border-radius: 10px;
    border: 1px solid var(--border);
  }

  .step-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 12px;
    color: var(--muted);
    opacity: 0.4;
    transition: all 0.3s;
  }

  .step-item.active { opacity: 1; color: #3a6bc7; }
  .step-item.done { opacity: 0.8; color: var(--success); }

  .step-dot {
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: currentColor;
    flex-shrink: 0;
  }

  .step-item.active .step-dot {
    animation: pulse 1.2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.6; }
  }

  /* ‚îÄ‚îÄ COUNTER ‚îÄ‚îÄ */
  .counter-row {
    display: flex;
    gap: 16px;
    margin-top: 28px;
    padding-top: 24px;
    border-top: 1px solid var(--border);
  }

  .counter {
    flex: 1;
    text-align: center;
  }

  .counter-val {
    font-family: 'Syne', sans-serif;
    font-size: 26px;
    font-weight: 800;
    color: var(--brand);
    line-height: 1;
  }

  .counter-label {
    font-size: 10px;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 4px;
    font-weight: 500;
  }

  .counter-sep {
    width: 1px;
    background: var(--border);
    align-self: stretch;
  }

  /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
  footer {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: 20px;
    font-size: 11px;
    color: var(--muted);
    border-top: 1px solid var(--border);
    background: var(--white);
  }

  footer a {
    color: var(--brand);
    text-decoration: none;
    font-weight: 500;
  }

  /* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
  @media (max-width: 560px) {
    header { padding: 16px 20px; }
    .card-top, .card-body { padding-left: 24px; padding-right: 24px; }
    .card-title { font-size: 24px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-mark">
      <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
    </div>
    <div class="logo-name">Auro<span>Edge</span></div>
  </div>
  <div class="header-tag">People Research</div>
</header>

<!-- MAIN -->
<main>
  <div class="card">

    <!-- CARD TOP -->
    <div class="card-top">
      <div class="card-eyebrow">B2B Intelligence Tool</div>
      <div class="card-title">Find Decision<br><span>Makers</span></div>
      <div class="card-desc">Enter a company and role ‚Äî results go directly to your Google Sheet.</div>
    </div>

    <!-- CARD BODY -->
    <div class="card-body">

      <!-- WEBHOOK CONFIG -->
      <div class="form-group">
        <div class="webhook-label">‚öô n8n Webhook URL</div>
        <div class="webhook-row">
          <input class="webhook-input" type="text" id="webhookUrl" placeholder="https://your-n8n.com/webhook/people-research">
          <button class="btn-save" onclick="saveWebhook()">Save</button>
        </div>
      </div>

      <div class="divider"></div>

      <!-- COMPANY -->
      <div class="form-group">
        <label for="companyName">Company Name</label>
        <div class="input-wrap">
          <span class="input-icon">üè¢</span>
          <input type="text" id="companyName" placeholder="e.g. Infosys, Wipro, TCS, SAP">
        </div>
        <div class="suggestions">
          <span class="chip" onclick="fill('companyName','Infosys')">Infosys</span>
          <span class="chip" onclick="fill('companyName','Wipro')">Wipro</span>
          <span class="chip" onclick="fill('companyName','HCL')">HCL</span>
          <span class="chip" onclick="fill('companyName','TCS')">TCS</span>
          <span class="chip" onclick="fill('companyName','SAP')">SAP</span>
        </div>
      </div>

      <!-- DESIGNATION -->
      <div class="form-group">
        <label for="designation">Target Designation</label>
        <div class="input-wrap">
          <span class="input-icon">üë§</span>
          <input type="text" id="designation" placeholder="e.g. HR Manager, VP Sales, CTO">
        </div>
        <div class="suggestions">
          <span class="chip" onclick="fill('designation','HR Manager')">HR Manager</span>
          <span class="chip" onclick="fill('designation','VP Sales')">VP Sales</span>
          <span class="chip" onclick="fill('designation','CTO')">CTO</span>
          <span class="chip" onclick="fill('designation','IT Manager')">IT Manager</span>
        </div>
      </div>

      <!-- SUBMIT -->
      <button class="btn-submit" id="submitBtn" onclick="runSearch()">
        <div class="btn-inner">
          <div class="spinner" id="spinner"></div>
          <span id="btnText">Search & Save to Sheet</span>
        </div>
      </button>

      <!-- PROGRESS STEPS -->
      <div class="progress-steps" id="progressSteps">
        <div class="step-item" id="s1"><div class="step-dot"></div>Finding company LinkedIn page...</div>
        <div class="step-item" id="s2"><div class="step-dot"></div>Searching LinkedIn profiles...</div>
        <div class="step-item" id="s3"><div class="step-dot"></div>Extracting tenure & location...</div>
        <div class="step-item" id="s4"><div class="step-dot"></div>Saving to Google Sheet...</div>
      </div>

      <!-- STATUS MESSAGE -->
      <div class="status" id="statusMsg"></div>

      <!-- COUNTERS -->
      <div class="counter-row">
        <div class="counter">
          <div class="counter-val" id="cSearches">0</div>
          <div class="counter-label">Searches Run</div>
        </div>
        <div class="counter-sep"></div>
        <div class="counter">
          <div class="counter-val" id="cPeople">0</div>
          <div class="counter-label">People Found</div>
        </div>
        <div class="counter-sep"></div>
        <div class="counter">
          <div class="counter-val" id="cSaved">0</div>
          <div class="counter-label">Saved to Sheet</div>
        </div>
      </div>

    </div>
  </div>
</main>

<!-- FOOTER -->
<footer>
  Built by <a href="#">AuroEdge Pvt. Ltd.</a> &nbsp;¬∑&nbsp; Results saved to <a href="https://docs.google.com/spreadsheets/d/1BqIFJ1TxORa5iasspS7HSCcLWQWBCrVO4LlndfrvMsA/edit" target="_blank">Google Sheet ‚Üó</a>
</footer>

<script>
  // ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
  let searches = parseInt(localStorage.getItem('ae_searches') || '0');
  let people   = parseInt(localStorage.getItem('ae_people')   || '0');
  let saved    = parseInt(localStorage.getItem('ae_saved')    || '0');

  (function init() {
    const wh = localStorage.getItem('ae_webhook');
    if (wh) document.getElementById('webhookUrl').value = wh;
    updateCounters();
  })();

  function updateCounters() {
    document.getElementById('cSearches').textContent = searches;
    document.getElementById('cPeople').textContent   = people;
    document.getElementById('cSaved').textContent    = saved;
  }

  function fill(id, val) { document.getElementById(id).value = val; }

  function saveWebhook() {
    const url = document.getElementById('webhookUrl').value.trim();
    if (!url) return;
    localStorage.setItem('ae_webhook', url);
    showStatus('success', '‚úÖ Webhook URL saved!');
    setTimeout(clearStatus, 2000);
  }

  // ‚îÄ‚îÄ NORMALIZE n8n response ‚Üí extract count of people found ‚îÄ‚îÄ
  function extractCount(data) {
    if (!data) return 0;
    // Flat array of people
    if (Array.isArray(data)) {
      return data.filter(p => p && (p.name || (p.json && p.json.name))).length;
    }
    // { results: [...] }
    if (Array.isArray(data.results)) return data.results.filter(p => p && p.name).length;
    // { count: N }
    if (typeof data.count === 'number') return data.count;
    // { success: false }
    if (data.success === false) return 0;
    return 0;
  }

  // ‚îÄ‚îÄ MAIN SEARCH ‚îÄ‚îÄ
  async function runSearch() {
    const company     = document.getElementById('companyName').value.trim();
    const designation = document.getElementById('designation').value.trim();
    const webhookUrl  = document.getElementById('webhookUrl').value.trim();

    if (!company || !designation) {
      showStatus('error', '‚ö†Ô∏è Please fill in both Company Name and Designation.');
      return;
    }
    if (!webhookUrl) {
      showStatus('error', '‚ö†Ô∏è Please enter and save your n8n Webhook URL first.');
      return;
    }

    setLoading(true);
    clearStatus();
    animateSteps();

    try {
      const response = await fetch(webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({
          'Company Name': company,
          'Target Designation': designation
        })
      });

      const rawText = await response.text();
      console.log('n8n response status:', response.status);
      console.log('n8n raw response:', rawText);

      if (!response.ok) {
        throw new Error(`Server returned ${response.status}. Check your webhook URL and that the workflow is active.`);
      }

      let data;
      try { data = JSON.parse(rawText); } catch { data = null; }

      const count = extractCount(data);

      // Update counters
      searches++;
      people += count;
      saved   += count;
      localStorage.setItem('ae_searches', searches);
      localStorage.setItem('ae_people',   people);
      localStorage.setItem('ae_saved',    saved);
      updateCounters();

      setLoading(false);

      if (count > 0) {
        showStatus('success',
          `‚úÖ Done! <strong>${count} profile${count > 1 ? 's' : ''}</strong> found for <em>${designation}</em> at <em>${company}</em> ‚Äî saved to Google Sheet.
          <br><br><a class="sheet-link-btn" href="https://docs.google.com/spreadsheets/d/1BqIFJ1TxORa5iasspS7HSCcLWQWBCrVO4LlndfrvMsA/edit" target="_blank">üìä Open Google Sheet ‚Üó</a>`
        );
      } else {
        showStatus('error',
          `‚ö†Ô∏è No profiles found for <em>${designation}</em> at <em>${company}</em>. Try a broader designation or different company name.`
        );
      }

      // Clear fields for next search
      document.getElementById('companyName').value = '';
      document.getElementById('designation').value = '';

    } catch (err) {
      console.error('Search error:', err);
      setLoading(false);

      let msg = err.message;
      if (msg.includes('Failed to fetch') || msg.includes('NetworkError') || msg.toLowerCase().includes('cors')) {
        msg = 'üîå Connection blocked (CORS). In n8n, open the Webhook node ‚Üí Options ‚Üí set <strong>Allowed Origins</strong> to <code>*</code>, then re-activate the workflow.';
      }

      showStatus('error', `‚ùå ${msg}`);
    }
  }

  // ‚îÄ‚îÄ STEPS ANIMATION ‚îÄ‚îÄ
  let stepTimer = null;
  function animateSteps() {
    const steps = ['s1','s2','s3','s4'];
    steps.forEach(s => document.getElementById(s).className = 'step-item');
    document.getElementById('progressSteps').style.display = 'flex';
    let i = 0;
    stepTimer = setInterval(() => {
      if (i > 0) document.getElementById(steps[i-1]).className = 'step-item done';
      if (i < steps.length) {
        document.getElementById(steps[i]).className = 'step-item active';
        i++;
      } else {
        clearInterval(stepTimer);
      }
    }, 900);
  }

  function stopSteps() {
    clearInterval(stepTimer);
    ['s1','s2','s3','s4'].forEach(s => document.getElementById(s).className = 'step-item done');
    setTimeout(() => {
      document.getElementById('progressSteps').style.display = 'none';
    }, 600);
  }

  // ‚îÄ‚îÄ UI HELPERS ‚îÄ‚îÄ
  function setLoading(on) {
    document.getElementById('submitBtn').disabled = on;
    document.getElementById('spinner').style.display = on ? 'block' : 'none';
    document.getElementById('btnText').textContent = on ? 'Searching...' : 'Search & Save to Sheet';
    if (!on) stopSteps();
  }

  function showStatus(type, html) {
    const el = document.getElementById('statusMsg');
    el.className = 'status ' + type;
    el.innerHTML = html;
    el.style.display = 'block';
  }

  function clearStatus() {
    const el = document.getElementById('statusMsg');
    el.style.display = 'none';
    el.innerHTML = '';
  }

  // Enter key support
  document.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const active = document.activeElement.id;
      if (['companyName','designation'].includes(active)) runSearch();
    }
  });
</script>
</body>
</html>
